# Makefile ä½¿ç”¨æŒ‡å—

æœ¬æ–‡æ¡£ä»‹ç»å¦‚ä½•ä½¿ç”¨ç²¾ç®€çš„ `Makefile` æ¥ç®¡ç† EasyProxy é¡¹ç›®ã€‚

## ğŸ“¦ ä»€ä¹ˆæ˜¯ Make?

[Make](https://www.gnu.org/software/make/) æ˜¯ä¸€ä¸ªç»å…¸çš„æ„å»ºè‡ªåŠ¨åŒ–å·¥å…·ï¼Œå‡ ä¹åœ¨æ‰€æœ‰ Unix/Linux ç³»ç»Ÿä¸Šé¢„è£…ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

```bash
# æŸ¥çœ‹æ‰€æœ‰å‘½ä»¤
make help

# å¼€å‘æ¨¡å¼å®‰è£…
make dev

# è¿è¡ŒæœåŠ¡å™¨
make run

# æ„å»ºåŒ…
make build
```

## ğŸ”§ æ‰€æœ‰å‘½ä»¤

### å¼€å‘å‘½ä»¤

```bash
# å¼€å‘æ¨¡å¼å®‰è£…ï¼ˆåŒ…å«å¼€å‘ä¾èµ–ï¼‰
make dev

# è¿è¡Œä»£ç†æœåŠ¡å™¨
make run

# è‡ªå®šä¹‰ç«¯å£è¿è¡Œ
make run ARGS='-p 8080'

# æ¸…ç†æ„å»ºæ–‡ä»¶
make clean
```

### æ„å»ºå‘½ä»¤

```bash
# æ„å»ºåˆ†å‘åŒ…ï¼ˆç”Ÿæˆ .whl å’Œ .tar.gzï¼‰
make build
```

### å‘å¸ƒå‘½ä»¤

```bash
# å‘å¸ƒæ–°ç‰ˆæœ¬ï¼ˆè‡ªåŠ¨æ›´æ–°ç‰ˆæœ¬å·ã€æ„å»ºã€åˆ›å»ºæ ‡ç­¾ï¼‰
make release VERSION=0.3.0
```

### å¸®åŠ©å‘½ä»¤

```bash
# æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
make help
```

## ğŸ¯ å·¥ä½œæµç¤ºä¾‹

### åœºæ™¯ 1: å¼€å§‹å¼€å‘

```bash
# 1. å…‹éš†é¡¹ç›®
git clone https://github.com/Slothtron/easyproxy-py.git
cd easyproxy-py

# 2. å¼€å‘æ¨¡å¼å®‰è£…
make dev

# 3. è¿è¡Œæµ‹è¯•
make run
```

### åœºæ™¯ 2: æ„å»ºå’Œæµ‹è¯•

```bash
# 1. æ¸…ç†æ—§æ„å»º
make clean

# 2. æ„å»ºæ–°åŒ…
make build

# 3. æµ‹è¯•å®‰è£…
python -m venv test_venv
test_venv/bin/pip install dist/*.whl
test_venv/bin/easyproxy --version
rm -rf test_venv
```

### åœºæ™¯ 3: å‘å¸ƒæ–°ç‰ˆæœ¬

```bash
# 1. å‘å¸ƒæ–°ç‰ˆæœ¬ï¼ˆè‡ªåŠ¨å¤„ç†ç‰ˆæœ¬å·ã€æ„å»ºã€æ ‡ç­¾ï¼‰
make release VERSION=0.3.0

# 2. æ¨é€ä»£ç å’Œæ ‡ç­¾
git push origin develop
git push origin v0.3.0

# 3. æ‰‹åŠ¨ä¸Šä¼ åˆ° PyPI
python -m twine upload dist/*
```

### åœºæ™¯ 4: æ—¥å¸¸å¼€å‘

```bash
# ä¿®æ”¹ä»£ç 
vim easyproxy/proxy.py

# ç›´æ¥æµ‹è¯•ï¼ˆå¼€å‘æ¨¡å¼ä¸‹ä¿®æ”¹ç«‹å³ç”Ÿæ•ˆï¼‰
make run

# æˆ–
easyproxy start
```

## ğŸ“– å‘½ä»¤è¯¦è§£

### make dev

å¼€å‘æ¨¡å¼å®‰è£…ï¼ŒåŒ…å«å¼€å‘ä¾èµ–ã€‚

```bash
make dev
```

ç­‰åŒäºï¼š
```bash
pip install -e ".[dev]"
```

**ç‰¹ç‚¹ï¼š**
- å¯ç¼–è¾‘å®‰è£…ï¼ˆä¿®æ”¹ä»£ç ç«‹å³ç”Ÿæ•ˆï¼‰
- åŒ…å«å¼€å‘ä¾èµ–ï¼ˆpytestã€blackã€mypy ç­‰ï¼‰
- é€‚åˆæ—¥å¸¸å¼€å‘

### make run

è¿è¡Œä»£ç†æœåŠ¡å™¨ã€‚

```bash
# é»˜è®¤é…ç½®
make run

# è‡ªå®šä¹‰å‚æ•°
make run ARGS='-p 8080'
make run ARGS='-c config.yaml'
make run ARGS='--log-level DEBUG'
```

ç­‰åŒäºï¼š
```bash
python -m easyproxy start [ARGS]
```

### make clean

æ¸…ç†æ„å»ºæ–‡ä»¶ã€‚

```bash
make clean
```

æ¸…ç†ï¼š
- `dist/` ç›®å½•
- `build/` ç›®å½•
- `*.egg-info` ç›®å½•
- `__pycache__` ç›®å½•
- `*.pyc` æ–‡ä»¶

### make build

æ„å»ºåˆ†å‘åŒ…ã€‚

```bash
make build
```

æ‰§è¡Œæ­¥éª¤ï¼š
1. æ¸…ç†æ—§æ„å»ºæ–‡ä»¶
2. å‡çº§æ„å»ºå·¥å…·ï¼ˆbuildã€twineï¼‰
3. æ„å»ºåŒ…ï¼ˆç”Ÿæˆ .whl å’Œ .tar.gzï¼‰
4. æ£€æŸ¥åŒ…å®Œæ•´æ€§

ç”Ÿæˆæ–‡ä»¶ï¼š
- `dist/easyproxy-x.x.x-py3-none-any.whl` - Wheel åŒ…ï¼ˆå¿«é€Ÿå®‰è£…ï¼‰
- `dist/easyproxy-x.x.x.tar.gz` - æºç åŒ…ï¼ˆå®Œæ•´é¡¹ç›®ï¼‰

### make release

å‘å¸ƒæ–°ç‰ˆæœ¬ã€‚

```bash
make release VERSION=0.3.0
```

æ‰§è¡Œæ­¥éª¤ï¼š
1. æ£€æŸ¥ç‰ˆæœ¬å·å‚æ•°
2. æ›´æ–° `pyproject.toml` ä¸­çš„ç‰ˆæœ¬å·
3. æ›´æ–° `easyproxy/cli.py` ä¸­çš„ç‰ˆæœ¬å·
4. æ„å»ºåˆ†å‘åŒ…
5. åˆ›å»º Git æäº¤
6. åˆ›å»º Git æ ‡ç­¾
7. æ˜¾ç¤ºåç»­æ­¥éª¤æç¤º

**æ³¨æ„ï¼š** ä¸ä¼šè‡ªåŠ¨æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼Œéœ€è¦æ‰‹åŠ¨æ¨é€ã€‚

## ğŸ” é«˜çº§ç”¨æ³•

### è‡ªå®šä¹‰ Python è§£é‡Šå™¨

```bash
# ä½¿ç”¨ç‰¹å®š Python ç‰ˆæœ¬
make PYTHON=python3.11 build
```

### è‡ªå®šä¹‰ pip

```bash
# ä½¿ç”¨ç‰¹å®š pip
make PIP=pip3 dev
```

### é“¾å¼è°ƒç”¨

```bash
# ä¾æ¬¡æ‰§è¡Œå¤šä¸ªå‘½ä»¤
make clean && make build
```

## ğŸ’¡ æç¤ºå’ŒæŠ€å·§

### 1. æŸ¥çœ‹å‘½ä»¤æ‰§è¡Œè¿‡ç¨‹

Makefile é»˜è®¤éšè—å‘½ä»¤è¾“å‡ºï¼ˆä½¿ç”¨ `@` å‰ç¼€ï¼‰ï¼Œå¦‚æœéœ€è¦æŸ¥çœ‹ï¼š

```bash
# ç§»é™¤ @ å‰ç¼€æˆ–ä½¿ç”¨ make -n æŸ¥çœ‹å°†è¦æ‰§è¡Œçš„å‘½ä»¤
make -n build
```

### 2. å¼€å‘å·¥ä½œæµ

```bash
# ä¸€æ¬¡æ€§è®¾ç½®å¼€å‘ç¯å¢ƒ
make dev

# æ—¥å¸¸å¼€å‘
vim easyproxy/proxy.py
make run ARGS='-p 8080'

# æäº¤å‰æ¸…ç†
make clean
```

### 3. å‘å¸ƒå·¥ä½œæµ

```bash
# å‘å¸ƒæµç¨‹
make release VERSION=0.3.0
git push origin develop
git push origin v0.3.0
python -m twine upload dist/*
```

## ğŸ†š Make çš„ä¼˜åŠ¿

1. **é¢„è£…**: å‡ ä¹æ‰€æœ‰ Unix/Linux ç³»ç»Ÿéƒ½é¢„è£…
2. **æ ‡å‡†åŒ–**: ä¸šç•Œæ ‡å‡†ï¼Œæ›´å¤šå¼€å‘è€…ç†Ÿæ‚‰
3. **ç®€æ´**: åªä¿ç•™æ ¸å¿ƒåŠŸèƒ½ï¼Œæ˜“äºç»´æŠ¤
4. **å¿«é€Ÿ**: æ— éœ€é¢å¤–å®‰è£…å’Œé…ç½®
5. **å…¼å®¹æ€§**: ä¸ CI/CD ç³»ç»Ÿæ— ç¼é›†æˆ

## ğŸ“š å‚è€ƒèµ„æº

- [GNU Make å®˜æ–¹æ–‡æ¡£](https://www.gnu.org/software/make/manual/)
- [Make æ•™ç¨‹](https://makefiletutorial.com/)
- [Python æ‰“åŒ…æŒ‡å—](https://packaging.python.org/)

## ğŸ“ å­¦ä¹ å»ºè®®

1. **ä»ç®€å•å¼€å§‹**: å…ˆä½¿ç”¨ `make help` æŸ¥çœ‹å¯ç”¨å‘½ä»¤
2. **æŸ¥çœ‹æºç **: æ‰“å¼€ `Makefile` äº†è§£å®ç°
3. **å®è·µ**: åœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨ï¼Œç†Ÿæ‚‰å¸¸ç”¨å‘½ä»¤
4. **ä¿æŒç®€æ´**: åªæ·»åŠ çœŸæ­£éœ€è¦çš„å‘½ä»¤

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [QUICKSTART.md](../QUICKSTART.md) - å¿«é€Ÿå‚è€ƒ
- [PROJECT_STRUCTURE.md](PROJECT_STRUCTURE.md) - é¡¹ç›®ç»“æ„è¯´æ˜
- [README.md](../README.md) - é¡¹ç›®ä¸»æ–‡æ¡£

## ğŸ“ Makefile å†…å®¹

å½“å‰ Makefile éå¸¸ç²¾ç®€ï¼ˆçº¦ 80 è¡Œï¼‰ï¼ŒåªåŒ…å«æ ¸å¿ƒåŠŸèƒ½ï¼š

```makefile
# å¼€å‘å‘½ä»¤
make dev     # å¼€å‘æ¨¡å¼å®‰è£…
make run     # è¿è¡ŒæœåŠ¡å™¨
make clean   # æ¸…ç†æ„å»ºæ–‡ä»¶

# æ„å»ºå‘½ä»¤
make build   # æ„å»ºåˆ†å‘åŒ…

# å‘å¸ƒå‘½ä»¤
make release VERSION=x.x.x  # å‘å¸ƒæ–°ç‰ˆæœ¬

# å¸®åŠ©å‘½ä»¤
make help    # æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
```

**è®¾è®¡ç†å¿µï¼š**
- âœ… åªä¿ç•™æœ€æ ¸å¿ƒçš„åŠŸèƒ½
- âœ… ç®€æ´æ˜äº†ï¼Œæ˜“äºç»´æŠ¤
- âœ… ä¸“æ³¨äºæ„å»ºå’Œå¼€å‘
- âœ… å…¶ä»–åŠŸèƒ½äº¤ç»™ä¸“é—¨çš„å·¥å…·

## ğŸ¯ æœ€ä½³å®è·µ

1. **ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒ**: å§‹ç»ˆåœ¨è™šæ‹Ÿç¯å¢ƒä¸­å¼€å‘
2. **å¼€å‘æ¨¡å¼**: ä½¿ç”¨ `make dev` è€Œä¸æ˜¯ `pip install .`
3. **æ¸…ç†ä¹ æƒ¯**: æ„å»ºå‰å…ˆ `make clean`
4. **ç‰ˆæœ¬ç®¡ç†**: ä½¿ç”¨ `make release` è‡ªåŠ¨åŒ–ç‰ˆæœ¬å‘å¸ƒ
5. **ä¿æŒç®€æ´**: ä¸è¦åœ¨ Makefile ä¸­æ·»åŠ è¿‡å¤šåŠŸèƒ½

---

**æç¤º:** è¿™ä¸ªç²¾ç®€çš„ Makefile ä¸“æ³¨äºæ ¸å¿ƒçš„å¼€å‘å’Œæ„å»ºä»»åŠ¡ï¼Œè®©é¡¹ç›®æ›´æ˜“ç»´æŠ¤ï¼ğŸš€